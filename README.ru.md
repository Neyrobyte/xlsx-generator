[English](README.md) | **Русский**
<p align="center">
  <img src="logo.svg" alt="" width="256">
</p>

---

# XLSX Генератор
Генерация таблиц Excel из простых текстовых данных. Дополнительный инструмент для AI
## Для пользователей
### Назначение скрипта
Этот скрипт преобразует текстовые файлы в форматированные Excel-файлы (XLSX) с автоматическим применением стилей:
- Автоматическое определение типов данных (числа, даты, текст)
- Цветовое выделение разных типов данных
- Форматирование границ и заголовков
- Автоподбор ширины столбцов

### Требования
- Python 3.6 или новее
- Установленные зависимости: `openpyxl`

### Установка зависимостей
```bash
pip install openpyxl
```

### Использование
1. Создайте текстовый файл `xlsx_generate.txt` в той же папке, где находится скрипт
2. Заполните его данными по описанному ниже формату
3. Запустите скрипт: `python3 xlsx.py`
4. Результат будет сохранен в `storage/shared/download/output.xlsx`

### Формат входного файла
Файл должен содержать данные в следующем формате:
```
sheet:ListName1
Tutle1;Title2;Title3
value1;value2;value3
42;2023-01-01;Text

sheet:ListName2
OtherTitle1;OtherTitle2
100;Example Text
```

#### Особенности формата:
- Разделитель листов - пустая строка
- Имя листа указывается в строке `sheet:ListName`
- Данные разделяются точкой с запятой (`;`)
- Поддерживаются специальные форматы для ячеек:
  - Даты: `YYYY-MM-DD`, `DD/MM/YYYY`, `DD.MM.YYYY`
  - Формулы Excel: `{"value": "=SUM(A1:A10)"}`
  - JSON-формат для сложных значений: `{"value": "text"}`

### Результат работы
Скрипт создаст Excel-файл со следующими особенностями:
- Заголовки с серым фоном и жирным шрифтом
- Первый столбец с светло-серым фоном
- Числовые столбцы с чередующимися бледно-голубым и бледно-синим фоном
- Текстовые столбцы с чередующимися бледно-зеленым и бледно-оранжевым фоном
- Столбцы с датами с бледно-фиолетовым фоном
- Толстые внешние границы таблицы
- Автоподобранная ширина столбцов

## Для разработчиков

### Архитектура скрипта
Скрипт состоит из следующих основных функций:
1. `parse_input_file` - парсинг входного текстового файла
2. `apply_default_styles` - применение стилей к листу Excel
3. `generate_xlsx` - основная функция генерации файла

### Конфигурация стилей
Стили определяются в словаре `DEFAULT_STYLES` в начале скрипта. Можно изменять:
- Цвета заливки
- Настройки шрифтов
- Границы
- Выравнивание текста

### Расширение функциональности
1. **Добавление новых типов данных**:
   - Реализуйте новую функцию проверки типа (по аналогии с `is_number` и `is_date`)
   - Добавьте соответствующий стиль в `DEFAULT_STYLES`
   - Модифицируйте логику в `apply_default_styles`

2. **Изменение формата входных данных**:
   - Модифицируйте функцию `parse_input_file`
   - Обновите документацию для пользователей

3. **Добавление новых стилей**:
   - Используйте методы библиотеки `openpyxl.styles`
   - Добавьте новые параметры в `DEFAULT_STYLES`

### Тестирование
Для тестирования изменений:
1. Создайте тестовый входной файл
2. Запустите скрипт
3. Проверьте результат в выходном файле

### Обработка ошибок
Скрипт обрабатывает основные ошибки:
- Отсутствие входного файла
- Ошибки парсинга JSON
- Ошибки форматирования дат

Для добавления новой обработки ошибок модифицируйте блок `try-except` в функции `generate_xlsx`.

### Зависимости
- `openpyxl` - для работы с Excel-файлами
- Стандартные библиотеки Python: `datetime`, `re`, `json`, `os`

### Совместимость
Скрипт тестировался на:
- Python 3.6+
- OpenPyXL 3.0+

## **Документация для нейросети (AI Guidelines)**  

Этот раздел предназначен для нейросетей, которые будут анализировать репозиторий и генерировать вводные данные для скрипта `xlsx-generator`.  

#### **1. Структура вводных данных**  
Скрипт ожидает на вход JSON-структуру, описывающую таблицу. Формат:  
```json
{
  "filename": "название_файла.xlsx",
  "sheets": [
    {
      "name": "Название листа",
      "headers": ["Заголовок1", "Заголовок2", ...],
      "rows": [
        ["Значение1", "Значение2", ...],
        ...
      ],
      "styles": {
        "header": { ... },
        "cells": { ... }
      }
    }
  ]
}
```  

#### **2. Подробные требования к полям**  
- **`filename`** (строка):  
  - Должен заканчиваться на `.xlsx`.  
  - Если не указан, используется `output.xlsx`.  

- **`sheets`** (массив объектов):  
  - Каждый объект описывает отдельный лист.  
  - **`name`** (строка): Название листа (если не указано, будет `Sheet1`, `Sheet2`, ...).  
  - **`headers`** (массив строк): Заголовки столбцов. Если не нужны, можно опустить.  
  - **`rows`** (массив массивов): Данные таблицы. Каждый подмассив — строка.  
  - **`styles`** (объект, опционально): Стилизация.  

#### **3. Стилизация (`styles`)**  
Скрипт поддерживает базовое форматирование через библиотеку `openpyxl`. Пример:  
```json
"styles": {
  "header": {
    "font": {"bold": true, "color": "FF0000"},
    "fill": {"patternType": "solid", "fgColor": "FFFF00"}
  },
  "cells": {
    "font": {"size": 12},
    "alignment": {"horizontal": "center"}
  }
}
```  
Допустимые параметры:  
- **`font`**: `bold`, `italic`, `size`, `color` (HEX-формат).  
- **`fill`**: `patternType`, `fgColor` (цвет заливки).  
- **`alignment`**: `horizontal`, `vertical`.  

#### **4. Особенности генерации**  
- Если строк меньше, чем заголовков, пустые ячейки заполняются `null`.  
- Если столбцов в строке больше, чем заголовков, лишние данные игнорируются.  
- Скрипт автоматически подгоняет ширину столбцов под содержимое.  

#### **5. Пример запроса для нейросети**  
**Запрос пользователя:**  
> "Создай таблицу с двумя листами: первый — 'Отчет' с заголовками ['ID', 'Имя', 'Баллы'] и 3 строками данных, второй — 'Статистика' с заголовком ['Средний балл'] и одной строкой с вычисленным значением."  

**Сгенерированные вводные (JSON):**  
```json
{
  "filename": "report.xlsx",
  "sheets": [
    {
      "name": "Отчет",
      "headers": ["ID", "Имя", "Баллы"],
      "rows": [
        [1, "Алексей", 85],
        [2, "Мария", 92],
        [3, "Иван", 78]
      ]
    },
    {
      "name": "Статистика",
      "headers": ["Средний балл"],
      "rows": [[85]]
    }
  ]
}
```  

#### **6. Важные замечания**  
- Нейросеть **должна** проверять структуру JSON перед генерацией.  
- Если в запросе пользователя есть математические вычисления (например, "средний балл"), нейросеть должна сама их выполнить и вставить результат в `rows`.  
- Для сложных стилей можно оставить `styles` пустым — скрипт использует настройки по умолчанию.  
